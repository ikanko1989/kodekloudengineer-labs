Some new requirements have come up to install and configure some packages on the Nautilus infrastructure under Stratos Datacenter. The Nautilus DevOps team installed and configured a new Jenkins server so they wanted to create a Jenkins job to automate this task. Find below more details and complete the task accordingly:
1. Access the Jenkins UI by clicking on the Jenkins button in the top bar. Log in using the credentials: username admin and password Adm!n321.
2. Create a new Jenkins job named install-packages and configure it with the following specifications:
Add a string parameter named PACKAGE.
Configure the job to install a package specified in the $PACKAGE parameter on the storage server within the Stratos Datacenter.

Note:
1. Ensure to install any required plugins and restart the Jenkins service if necessary. Opt for Restart Jenkins when installation is complete and no jobs are running on the plugin installation/update page. Refresh the UI page if needed after restarting the service.
2. Verify that the Jenkins job runs successfully on repeated executions to ensure reliability.
3. Capture screenshots of your configuration for documentation and review purposes. Alternatively, use screen recording software like loom.com for comprehensive documentation and sharing.


############################
SOLUTION
############################


1)LOGIN TO JENKINS SERVER:
thor@jumphost ~$ ssh jenkins@jenkins

jenkins@jenkins:~/.ssh$  ssh-keygen -t rsa -b 2048 

jenkins@jenkins:~/.ssh$ ssh-copy-id natasha@ststor01
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/var/lib/jenkins/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
natasha@ststor01's password: 

Number of key(s) added: 1
Now try logging into the machine, with:   "ssh 'natasha@ststor01'"
and check to make sure that only the key(s) you wanted were added.
jenkins@jenkins:~/.ssh$ ssh natasha@ststor01
Last failed login: Thu Jan 23 08:15:45 UTC 2025 from 172.16.238.19 on ssh:notty
There was 1 failed login attempt since the last successful login.
Last login: Thu Jan 23 08:03:56 2025 from 172.16.238.3
[natasha@ststor01 ~]$ 


TO AVOID SUDO PASS ADD IT TO /etc/sudoers:
[natasha@ststor01 ~]$ sudo cat /etc/sudoers
...
natasha ALL=(ALL) NOPASSWD: ALL



2)CREATE AND SET JENKINS JOB:
Clicking New Item from the Jenkins dashboard,select "Freestyle job", and then giving the item a name "install-packages" 
This project is parameterized
String Parameter
Name
PACKAGE
Default Value


Build Steps
Execute shell
Command
See the list of available environment variables
STORAGE_SERVER="ststor01"
SSH_USER="natasha"
ssh $SSH_USER@$STORAGE_SERVER "sudo dnf install -y $PACKAGE"


3)BUILD JOB WITH SOME PACKAGE:
CLICK ON install-packages job:
Project install-packages
This build requires parameters:
PACKAGE
nginx



4)CONSOLE OUTPUT JENKINS:
Started by user admin
Running as SYSTEM
Building in workspace /var/lib/jenkins/workspace/install-packages
[install-packages] $ /bin/sh -xe /tmp/jenkins1657646421733842527.sh
+ STORAGE_SERVER=ststor01
+ SSH_USER=natasha
+ ssh natasha@ststor01 sudo dnf install -y nginx
Waiting for process with pid 3538 to finish.
Last metadata expiration check: 0:00:02 ago on Thu Jan 23 08:23:17 2025.
Dependencies resolved.
================================================================================
 Package                 Arch        Version               Repository      Size
================================================================================
Installing:
 nginx                   x86_64      2:1.20.1-20.el9       appstream       36 k
Installing dependencies:
 centos-logos-httpd      noarch      90.8-1.el9            appstream      1.5 M
 nginx-core              x86_64      2:1.20.1-20.el9       appstream      570 k
 nginx-filesystem        noarch      2:1.20.1-20.el9       appstream      9.2 k
Installing weak dependencies:
 logrotate               x86_64      3.18.0-9.el9          baseos          75 k

Transaction Summary
================================================================================
Install  5 Packages

Total download size: 2.2 M
Installed size: 4.5 M
Downloading Packages:
Waiting for process with pid 3538 to finish.
(1/5): logrotate-3.18.0-9.el9.x86_64.rpm        817 kB/s |  75 kB     00:00    
(2/5): nginx-1.20.1-20.el9.x86_64.rpm           322 kB/s |  36 kB     00:00    
(3/5): nginx-filesystem-1.20.1-20.el9.noarch.rp 237 kB/s | 9.2 kB     00:00    
(4/5): centos-logos-httpd-90.8-1.el9.noarch.rpm 4.4 MB/s | 1.5 MB     00:00    
(5/5): nginx-core-1.20.1-20.el9.x86_64.rpm      1.9 MB/s | 570 kB     00:00    
--------------------------------------------------------------------------------
Total                                           3.7 MB/s | 2.2 MB     00:00     
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1 
  Running scriptlet: nginx-filesystem-2:1.20.1-20.el9.noarch                1/5 
  Installing       : nginx-filesystem-2:1.20.1-20.el9.noarch                1/5 
  Installing       : nginx-core-2:1.20.1-20.el9.x86_64                      2/5 
  Installing       : centos-logos-httpd-90.8-1.el9.noarch                   3/5 
  Running scriptlet: logrotate-3.18.0-9.el9.x86_64                          4/5 
  Installing       : logrotate-3.18.0-9.el9.x86_64                          4/5 
  Running scriptlet: logrotate-3.18.0-9.el9.x86_64                          4/5 
Created symlink /etc/systemd/system/timers.target.wants/logrotate.timer ��� /usr/lib/systemd/system/logrotate.timer.

  Installing       : nginx-2:1.20.1-20.el9.x86_64                           5/5 
  Running scriptlet: nginx-2:1.20.1-20.el9.x86_64                           5/5 
  Verifying        : logrotate-3.18.0-9.el9.x86_64                          1/5 
  Verifying        : centos-logos-httpd-90.8-1.el9.noarch                   2/5 
  Verifying        : nginx-2:1.20.1-20.el9.x86_64                           3/5 
  Verifying        : nginx-core-2:1.20.1-20.el9.x86_64                      4/5 
  Verifying        : nginx-filesystem-2:1.20.1-20.el9.noarch                5/5 

Installed:
  centos-logos-httpd-90.8-1.el9.noarch      logrotate-3.18.0-9.el9.x86_64      
  nginx-2:1.20.1-20.el9.x86_64              nginx-core-2:1.20.1-20.el9.x86_64  
  nginx-filesystem-2:1.20.1-20.el9.noarch  

Complete!
Finished: SUCCESS

5)CHECK VERSION ON STORAGE_SERVER:
[natasha@ststor01 ~]$  nginx -version
nginx version: nginx/1.20.1
